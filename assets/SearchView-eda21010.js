import{o as r,c,e as g,a as i,d,t as h,F as p,r as v,b as u,h as b,w as y,i as k}from"./index-098e3105.js";import{L as m}from"./LayoutHeader-666f4c4f.js";import{L as f}from"./LayoutFooter-35dbfd97.js";const _={class:"container"},S={class:"row justify-content-md-center"},D={class:"col-md-5 mt-2"},x={class:"card"},E={class:"card-header"},M=i("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor",class:"bi bi-person-rolodex",viewBox:"0 0 20 20"},[i("path",{d:"M8 9.05a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5"}),i("path",{d:"M1 1a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h.5a.5.5 0 0 0 .5-.5.5.5 0 0 1 1 0 .5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5.5.5 0 0 1 1 0 .5.5 0 0 0 .5.5h.5a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H6.707L6 1.293A1 1 0 0 0 5.293 1zm0 1h4.293L6 2.707A1 1 0 0 0 6.707 3H15v10h-.085a1.5 1.5 0 0 0-2.4-.63C11.885 11.223 10.554 10 8 10c-2.555 0-3.886 1.224-4.514 2.37a1.5 1.5 0 0 0-2.4.63H1z"})],-1),T={class:"list-group list-group-flush"},j={class:"list-group-item"},L={class:"form-check"},w=["value","id"],C=["for"],N={key:0,class:"text-muted mx-2",style:{"font-size":"90%"}},q={class:"text-center mt-3"},F={key:1,type:"button",class:"btn btn-warning btn-lg rounded-pill px-5",disabled:""},H=i("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1),O={components:{LayoutHeader:m,LayoutFooter:f},props:["env","api_url","client_info"],data(){return{exhibition:this.getMyData("exhibition"),router:b(),qrcode:"",sign:null,chkid:[],loading:!0}},created(){this.qrcode=this.router.currentRoute.params.qrcode,setTimeout(this.getSignList(this.qrcode),100)},methods:{getMyData(t){let e=localStorage.getItem(t)||null;if(typeof e=="string")try{e=JSON.parse(e)}catch{}return e},setMyData(t,e){typeof e=="object"&&(e=JSON.stringify(e)),localStorage.setItem(t,e)},formatDate(t){let e=new Date(t);return String(e.getFullYear())+"-"+String(e.getMonth()+1).padEnd(2,"0")+"-"+String(e.getDate()).padEnd(2,"0")},formatDateTime(t){console.log(t);let e=new Date(t);return String(e.getFullYear())+"-"+String(e.getMonth()+1).padEnd(2,"0")+"-"+String(e.getDate()).padEnd(2,"0")+" "+String(e.getHours()).padEnd(2,"0")+":"+String(e.getMinutes()).padEnd(2,"0")},getSignList(){let t=this;if(t.api_url!="localhost"){const e=t.api_url+"api/getMemberTicketList",n=new Headers;n.append("Content-Type","application/json");const o={qrcode:t.qrcode,expocode:t.exhibition.expocode},l={mode:"no-cors",method:"POST",headers:n,redirect:"follow",body:JSON.stringify(o)};fetch(e,l).then(s=>{if(s.status==200)return s.json();alert(s.message)}).then(s=>{t.sign=s,t.sign.events.forEach(function(a){a.dt=a.evententrytime?t.formatDateTime(a.evententrytime):""})}).catch(s=>console.error("Error:",s))}else fetch("/data/demo.json").then(e=>e.json()).then(e=>{t.sign=e.sign,t.sign.events.forEach(function(n){console.log(t.formatDateTime(n.evententrytime)),n.dt=n.evententrytime?t.formatDateTime(n.evententrytime):""})})},checkin(){if(this.chkid.length==0)return alert("請先勾選要核銷的活動"),!1;let t=this;if(t.loading=!1,t.api_url!="localhost"){const e="http://dev.cc/cubic_dev.php",n=new Headers;n.append("Content-Type","application/json");const o={qrcode:"SFGJA2818",expocode:"EAF3911",eventids:t.chkid},l={mode:"no-cors",method:"POST",headers:n,redirect:"follow",body:JSON.stringify(o)};fetch(e,l).then(s=>{if(s.status==200)return s.json();alert(s.message)}).then(s=>{t.sign.events.forEach(function(a){s.eventids.includes(a.eventid)?a.checkin=!0:a.checkin=!1}),t.setMyData("sign",t.sign),t.loading=!1,t.$router.push("/complate")}).catch(s=>{t.loading=!1,console.error("Error:",s)})}else fetch("/data/demo.json").then(e=>e.json()).then(e=>{let n=e.checkin;t.sign.events.forEach(function(o){n.eventids.includes(o.eventid)?o.checkin=!0:o.checkin=!1}),t.setMyData("sign",t.sign),setTimeout(function(){t.$router.push("/complate")},500)})},backScan(){this.$router.push("/scan")}},mounted(){}},B=Object.assign(O,{__name:"SearchView",setup(t){return(e,n)=>(r(),c(p,null,[g(m,{env:t.env,client:t.client_info,exhibition:e.exhibition},null,8,["env","client","exhibition"]),i("div",_,[i("div",S,[i("div",D,[i("div",x,[i("div",E,[M,d(" "+h(e.sign.membername)+" 報名的活動清單 ",1)]),i("ul",T,[(r(!0),c(p,null,v(e.sign.events,o=>(r(),c("li",j,[i("div",L,[y(i("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":n[0]||(n[0]=l=>e.chkid=l),value:o.eventid,id:"checkbox_eventid_"+o.eventid},null,8,w),[[k,e.chkid]]),i("label",{class:"form-check-label",for:"checkbox_eventid_"+o.eventid},[d(h(o.eventname)+" ",1),o.dt?(r(),c("span",N,h(o.dt),1)):u("",!0)],8,C)])]))),256))])]),i("div",q,[i("button",{type:"button",class:"btn btn-outline-secondary btn-lg rounded-pill px-5 mx-2",onClick:n[1]||(n[1]=(...o)=>e.backScan&&e.backScan(...o))},"取消"),e.loading==!0?(r(),c("button",{key:0,type:"button",class:"btn btn-warning btn-lg rounded-pill px-5",onClick:n[2]||(n[2]=(...o)=>e.checkin&&e.checkin(...o))},"確認核銷")):u("",!0),e.loading==!1?(r(),c("button",F,[H,d(" Loading... ")])):u("",!0)])])])]),g(f,{env:t.env,client:t.client_info},null,8,["env","client"])],64))}});export{B as default};
